<div class="page-container">
    <!-- Chatbot Button with Avatar -->
    <button class="open-chat-btn" (click)="openChat()">
      <img src="../../assets/storiprof.png" alt="Aldo Moro" class="chat-btn-avatar" />
    </button>
  
    <!-- Chatbot Popup -->
    <div *ngIf="chatOpen" class="chat-popup">
      <div class="chat-header">
        <img src="../../assets/storiprof.png" alt="Aldo Moro" class="chat-avatar" />
        <span class="chat-name">Prof. Storia</span>
        <button class="close-chat-btn" (click)="closeChat()">X</button>
      </div>
      <div class="chat-body">
        <div class="messages">
          <div *ngFor="let msg of messages" class="message" [ngClass]="{'user-message': msg.startsWith('Tu:'), 'bot-message': !msg.startsWith('Tu:')}">
            {{ msg }}
          </div>
          <!-- Typing indicator -->
          <div *ngIf="isTyping" class="server-typing">Prof. Storia is typing...</div>
        </div>
        <!-- Input Row: Textarea + Button -->
        <div class="input-row">
          <textarea placeholder="Type a message..." #message (input)="adjustHeight(message)" (keydown)="onKeydown($event, message)"></textarea>
          <button class="send-button" (click)="sendMessage(message)">Send</button>
        </div>
      </div>
    </div>
  </div>